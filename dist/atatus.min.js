/*! AtatusJs - v1.3.0 - 2013-12-22
* https://github.com/fizerkhan/atatusjs
* Copyright (c) 2013 Atatus; Licensed MIT */
(function(e){function n(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function t(e){return e===undefined}var r={},i=e.TraceKit,u=[].slice,o="?";r.noConflict=function(){return e.TraceKit=i,r},r.wrap=function(e){function n(){try{return e.apply(this,arguments)}catch(n){throw r.report(n),n}}return n},r.report=function(){function t(e){c(),h.push(e)}function i(e){for(var n=h.length-1;n>=0;--n)h[n]===e&&h.splice(n,1)}function o(e,t){var i=null;if(!t||r.collectWindowErrors){for(var o in h)if(n(h,o))try{h[o].apply(null,[e].concat(u.call(arguments,2)))}catch(a){i=a}if(i)throw i}}function a(e,n,t){var i=null;if(p)r.computeStackTrace.augmentStackTraceWithInitialElement(p,n,t,e),i=p,p=null,g=null;else{var u={url:n,line:t};u.func=r.computeStackTrace.guessFunctionName(u.url,u.line),u.context=r.computeStackTrace.gatherContext(u.url,u.line),i={mode:"onerror",message:e,url:document.location.href,stack:[u],useragent:navigator.userAgent}}return o(i,"from window.onerror"),s?s.apply(this,arguments):!1}function c(){f!==!0&&(s=e.onerror,e.onerror=a,f=!0)}function l(n){var t=u.call(arguments,1);if(p){if(g===n)return;var i=p;p=null,g=null,o.apply(null,[i,null].concat(t))}var a=r.computeStackTrace(n);throw p=a,g=n,e.setTimeout(function(){g===n&&(p=null,g=null,o.apply(null,[a,null].concat(t)))},a.incomplete?2e3:0),n}var s,f,h=[],g=null,p=null;return l.subscribe=t,l.unsubscribe=i,l}(),r.computeStackTrace=function(){function i(n){if(!r.remoteFetching)return"";try{var t=function(){try{return new e.XMLHttpRequest}catch(n){return new e.ActiveXObject("Microsoft.XMLHTTP")}},i=t();return i.open("GET",n,!1),i.send(""),i.responseText}catch(u){return""}}function u(e){if(!n(T,e)){var t="";-1!==e.indexOf(document.domain)&&(t=i(e)),T[e]=t?t.split("\n"):[]}return T[e]}function a(e,n){var r,i=/function ([^(]*)\(([^)]*)\)/,a=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,c="",l=10,s=u(e);if(!s.length)return o;for(var f=0;l>f;++f)if(c=s[n-f]+c,!t(c)){if(r=a.exec(c))return r[1];if(r=i.exec(c))return r[1]}return o}function c(e,n){var i=u(e);if(!i.length)return null;var o=[],a=Math.floor(r.linesOfContext/2),c=a+r.linesOfContext%2,l=Math.max(0,n-a-1),s=Math.min(i.length,n+c-1);n-=1;for(var f=l;s>f;++f)t(i[f])||o.push(i[f]);return o.length>0?o:null}function l(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function s(e){return l(e).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function f(e,n){for(var t,r,i=0,o=n.length;o>i;++i)if((t=u(n[i])).length&&(t=t.join("\n"),r=e.exec(t)))return{url:n[i],line:t.substring(0,r.index).split("\n").length,column:r.index-t.lastIndexOf("\n",r.index)-1};return null}function h(e,n,t){var r,i=u(n),o=RegExp("\\b"+l(e)+"\\b");return t-=1,i&&i.length>t&&(r=o.exec(i[t]))?r.index:null}function g(n){for(var t,r,i,u,o=[e.location.href],a=document.getElementsByTagName("script"),c=""+n,h=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,g=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,p=0;a.length>p;++p){var m=a[p];m.src&&o.push(m.src)}if(i=h.exec(c)){var d=i[1]?"\\s+"+i[1]:"",v=i[2].split(",").join("\\s*,\\s*");t=l(i[3]).replace(/;$/,";?"),r=RegExp("function"+d+"\\s*\\(\\s*"+v+"\\s*\\)\\s*{\\s*"+t+"\\s*}")}else r=RegExp(l(c).replace(/\s+/g,"\\s+"));if(u=f(r,o))return u;if(i=g.exec(c)){var w=i[1];if(t=s(i[2]),r=RegExp("on"+w+"=[\\'\"]\\s*"+t+"\\s*[\\'\"]","i"),u=f(r,o[0]))return u;if(r=RegExp(t),u=f(r,o))return u}return null}function p(e){if(!e.stack)return null;for(var n,t,r=/^\s*at (?:((?:\[object object\])?\S+(?: \[as \S+\])?) )?\(?((?:file|http|https):.*?):(\d+)(?::(\d+))?\)?\s*$/i,i=/^\s*(\S*)(?:\((.*?)\))?@((?:file|http|https).*?):(\d+)(?::(\d+))?\s*$/i,u=e.stack.split("\n"),l=[],s=/^(.*) is undefined$/.exec(e.message),f=0,g=u.length;g>f;++f){if(n=i.exec(u[f]))t={url:n[3],func:n[1]||o,args:n[2]?n[2].split(","):"",line:+n[4],column:n[5]?+n[5]:null};else{if(!(n=r.exec(u[f])))continue;t={url:n[2],func:n[1]||o,line:+n[3],column:n[4]?+n[4]:null}}!t.func&&t.line&&(t.func=a(t.url,t.line)),t.line&&(t.context=c(t.url,t.line)),l.push(t)}return l[0]&&l[0].line&&!l[0].column&&s&&(l[0].column=h(s[1],l[0].url,l[0].line)),l.length?{mode:"stack",name:e.name,message:e.message,url:document.location.href,stack:l,useragent:navigator.userAgent}:null}function m(e){for(var n,t=e.stacktrace,r=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,i=t.split("\n"),u=[],o=0,l=i.length;l>o;o+=2)if(n=r.exec(i[o])){var s={line:+n[1],column:+n[2],func:n[3]||n[4],args:n[5]?n[5].split(","):[],url:n[6]};if(!s.func&&s.line&&(s.func=a(s.url,s.line)),s.line)try{s.context=c(s.url,s.line)}catch(f){}s.context||(s.context=[i[o+1]]),u.push(s)}return u.length?{mode:"stacktrace",name:e.name,message:e.message,url:document.location.href,stack:u,useragent:navigator.userAgent}:null}function d(t){var r=t.message.split("\n");if(4>r.length)return null;var i,o,l,h,g=/^\s*Line (\d+) of linked script ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,p=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,m=/^\s*Line (\d+) of function script\s*$/i,d=[],v=document.getElementsByTagName("script"),w=[];for(o in v)n(v,o)&&!v[o].src&&w.push(v[o]);for(o=2,l=r.length;l>o;o+=2){var x=null;if(i=g.exec(r[o]))x={url:i[2],func:i[3],line:+i[1]};else if(i=p.exec(r[o])){x={url:i[3],func:i[4]};var y=+i[1],k=w[i[2]-1];if(k&&(h=u(x.url))){h=h.join("\n");var T=h.indexOf(k.innerText);T>=0&&(x.line=y+h.substring(0,T).split("\n").length)}}else if(i=m.exec(r[o])){var S=e.location.href.replace(/#.*$/,""),O=i[1],b=RegExp(s(r[o+1]));h=f(b,[S]),x={url:S,line:h?h.line:O,func:""}}if(x){x.func||(x.func=a(x.url,x.line));var E=c(x.url,x.line),C=E?E[Math.floor(E.length/2)]:null;x.context=E&&C.replace(/^\s*/,"")===r[o+1].replace(/^\s*/,"")?E:[r[o+1]],d.push(x)}}return d.length?{mode:"multiline",name:t.name,message:r[0],url:document.location.href,stack:d,useragent:navigator.userAgent}:null}function v(e,n,t,r){var i={url:n,line:t};if(i.url&&i.line){e.incomplete=!1,i.func||(i.func=a(i.url,i.line)),i.context||(i.context=c(i.url,i.line));var u=/ '([^']+)' /.exec(r);if(u&&(i.column=h(u[1],i.url,i.line)),e.stack.length>0&&e.stack[0].url===i.url){if(e.stack[0].line===i.line)return!1;if(!e.stack[0].line&&e.stack[0].func===i.func)return e.stack[0].line=i.line,e.stack[0].context=i.context,!1}return e.stack.unshift(i),e.partial=!0,!0}return e.incomplete=!0,!1}function w(e,n){for(var t,i,u,c=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,l=[],s={},f=!1,p=w.caller;p&&!f;p=p.caller)if(p!==x&&p!==r.report){if(i={url:null,func:o,line:null,column:null},p.name?i.func=p.name:(t=c.exec(""+p))&&(i.func=t[1]),u=g(p)){i.url=u.url,i.line=u.line,i.func===o&&(i.func=a(i.url,i.line));var m=/ '([^']+)' /.exec(e.message||e.description);m&&(i.column=h(m[1],u.url,u.line))}s[""+p]?f=!0:s[""+p]=!0,l.push(i)}n&&l.splice(0,n);var d={mode:"callers",name:e.name,message:e.message,url:document.location.href,stack:l,useragent:navigator.userAgent};return v(d,e.sourceURL||e.fileName,e.line||e.lineNumber,e.message||e.description),d}function x(e,n){var t=null;n=null==n?0:+n;try{if(t=m(e))return t}catch(r){if(k)throw r}try{if(t=p(e))return t}catch(r){if(k)throw r}try{if(t=d(e))return t}catch(r){if(k)throw r}try{if(t=w(e,n+1))return t}catch(r){if(k)throw r}return{mode:"failed"}}function y(e){e=(null==e?0:+e)+1;try{throw Error()}catch(n){return x(n,e+1)}}var k=!1,T={};return x.augmentStackTraceWithInitialElement=v,x.guessFunctionName=a,x.gatherContext=c,x.ofCaller=y,x}(),function(){var n=function n(n){var t=e[n];e[n]=function(){var e=u.call(arguments),n=e[0];return"function"==typeof n&&(e[0]=r.wrap(n)),t.apply?t.apply(this,e):t(e[0],e[1])}};n("setTimeout"),n("setInterval")}(),r.remoteFetching||(r.remoteFetching=!0),r.collectWindowErrors||(r.collectWindowErrors=!0),(!r.linesOfContext||1>r.linesOfContext)&&(r.linesOfContext=11),e.TraceKit=r})(window),function(e,n){"use strict";if(e){var t=e.event.add;e.event.add=function(r,i,u,o,a){var c;return u.handler?(c=u.handler,u.handler=n.wrap(u.handler)):(c=u,u=n.wrap(u)),u.guid=c.guid?c.guid:c.guid=e.guid++,t.call(this,r,i,u,o,a)};var r=e.fn.ready;e.fn.ready=function(e){return r.call(this,n.wrap(e))};var i=e.ajax;e.ajax=function(t){for(var r,u=["complete","error","success"];r=u.pop();)e.isFunction(t[r])&&(t[r]=n.wrap(t[r]));try{return i.call(this,t)}catch(o){throw n.report(o),o}}}}(window.jQuery,window.TraceKit),function(e,n){function t(e,n,t,r){T.send(r||e.type,{status:n.status,statusText:n.statusText,type:t.type,url:t.url,contentType:t.contentType})}function r(n){e.console&&e.console.log&&y&&e.console.log(n)}function i(){return p&&""!==p?!0:(r("Atatus API key has not been configured, make sure you call atatus.init(yourApiKey)"),!1)}function u(e,n){var t,r={};for(t in e)r[t]=e[t];for(t in n)r[t]=n[t];return r}function o(e,n){for(var t=0;e.length>t;t++)n.call(null,t,e[t])}function a(e){for(var n in e)if(e.hasOwnProperty(n))return!1;return!0}function c(){var n=document.documentElement,t=document.getElementsByTagName("body")[0],r=e.innerWidth||n.clientWidth||t.clientWidth,i=e.innerHeight||n.clientHeight||t.clientHeight;return{width:r,height:i}}function l(n,t){var r=[],i={};n.stack&&n.stack.length&&o(n.stack,function(e,n){r.push({LineNumber:n.line,ClassName:"line "+n.line+", column "+n.column,FileName:n.url,MethodName:n.func||"[anonymous]"})}),e.location.search&&e.location.search.length>1&&o(e.location.search.substring(1).split("&"),function(e,n){var t=n.split("=");t&&2===t.length&&(i[decodeURIComponent(t[0])]=t[1])}),a(t)&&(t=k);var u=e.screen||{width:c().width,height:c().height,colorDepth:8},l={OccurredOn:new Date,Details:{Error:{ClassName:n.name,Message:n.message||"Script error",StackTrace:r},Environment:{UtcOffset:(new Date).getTimezoneOffset()/-60,"User-Language":navigator.userLanguage,"Document-Mode":document.documentMode,"Browser-Width":c().width,"Browser-Height":c().height,"Screen-Width":u.width,"Screen-Height":u.height,"Color-Depth":u.colorDepth,Browser:navigator.appCodeName,"Browser-Name":navigator.appName,"Browser-Version":navigator.appVersion,Platform:navigator.platform},Client:{Name:"atatus-js",Version:"1.2.1"},UserCustomData:t,Request:{Url:document.location.href,QueryString:i,Headers:{"User-Agent":navigator.userAgent,Referer:document.referrer,Host:document.domain}},Version:d||"Not supplied"}};m&&(l.Details.User=m),f(l,"exception")}function s(e,n,t){if(e){var r={OccurredOn:new Date,Message:e,Metadata:n,Type:t};f(r,"log")}}function f(e,n){if(i()){r("Sending data to Atatus:",e);var t="http://www.atatus.com/api/entries/"+n+"?apikey="+encodeURIComponent(p);g(t,JSON.stringify(e))}}function h(n,t){var i;return i=new e.XMLHttpRequest,"withCredentials"in i?i.open(n,t,!0):e.XDomainRequest&&(i=new e.XDomainRequest,i.open(n,t)),i.onload=function(){r("logged error to Atatus")},i.onerror=function(){r("failed to log error to Atatus")},i}function g(e,n){var t=h("POST",e);return t?(t.send(n),void 0):(r("CORS not supported"),void 0)}var p,m,d,v,w=TraceKit.noConflict(),x=e.atatus,y=!1,k={};n&&(v=n(document));var T={noConflict:function(){return e.atatus=x,T},init:function(e,n,t){return p=e,w.remoteFetching=!1,k=t,n&&n.debugMode&&(y=n.debugMode),T},withCustomData:function(e){return k=e,T},attach:function(){return i()?(w.report.subscribe(l),v&&v.ajaxError(t),T):void 0},detach:function(){return w.report.unsubscribe(l),v&&v.unbind("ajaxError",t),T},send:function(e,n){try{l(w.computeStackTrace(e),u(k,n))}catch(t){if(e!==t)throw t}return T},setUser:function(e){return m={Identifier:e},T},setVersion:function(e){return d=e,T},track:function(e,n,t){if(e){var r={OccurredOn:new Date,Message:e,Metadata:n,Parameters:t};f(r,"track")}},log:function(e,n){s(e,n,"INFO")},info:function(e,n){s(e,n,"INFO")},debug:function(e,n){s(e,n,"DEBUG")},warn:function(e,n){s(e,n,"WARN")},error:function(e,n){s(e,n,"ERROR")}};e.atatus=T}(window,window.jQuery);